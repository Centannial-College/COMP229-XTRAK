<!--
File: edit.ejs
Date: 10.11.2022
NAME: xTrak - Incident Reporting
Description: xTrak is a web app platform to capture data for incident. The reports are saved and organized in a list. 
---- DEVELOPERS ----
Tim Upton – 301259058 
Pedro Da Silva Dergado – 301239283 
Alex Damovski – 301192233 
Tyler Mercier – STUDENT NUM 
Danill Velykyi - 301183618
Cathy Da - 301177731 
-->

<div class="container-fluid" style="background-color: #8938F7; height: 100%">  
<div class="row row-cols-1 row-cols-md-2 g-4 text-center mt-5">
    <div class="col">
      <div class="card">
        <div class="card-body">
            <h5 class="card-title"><%= title %></h5>
            <hr>
            <!-- Form -->
            <form class="form" method="POST">
                <% if (incident.incidentStatus == "Archived") { %>
                    <fieldset disabled="disabled">
                <% } %>  
                <input type="hidden" name="id" value="<%= incident._id %>" >
                <div class="form-group">
                    <label for="incidentD">Incident Description</label>
                    <input type="text" class="form-control"
                    id="incidentD"
                    placeholder="Enter the description"
                    name="description" 
                    value="<%= incident.description %>"
                    required>
                </div>
    
                <div class="form-group">
                    <label for="priorityT">Priority type</label>
                    <select class="form-select" aria-label="Priority type" name="priority">
                        <% if (incident.priority == "Low") { %>
                                <option value="Low" selected>Low</option>
                            <% } else { %>
                                <option value="Low">Low</option>
                            <% } %>
                            <% if (incident.priority == "Normal") { %>
                                <option value="Normal" selected>Normal</option>
                            <% } else { %>
                                <option value="Normal">Normal</option>
                            <% } %>
                            <% if (incident.priority == "High") { %>
                                <option value="High" selected>High</option>
                            <% } else { %>
                                <option value="High">High</option>
                            <% } %>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="firstN">First Name</label>
                    <input type="text" class="form-control"
                    id="firstN"
                    placeholder="Enter first name"
                    name="firstName" 
                    value="<%= incident.firstName %>"
                    required>
                </div>
    
                <div class="form-group">
                    <label for="lastN">Last Name</label>
                    <input type="text" class="form-control"
                    id="lastN"
                    placeholder="Enter last name"
                    name="lastName"                     
                    value="<%= incident.lastName %>"
                    required
                    >
                    </input>
                </div>
    
                <div class="form-group">
                    <label for="emailA">Email Address</label>
                    <input type="text" class="form-control"
                    id="emailA"
                    placeholder="Enter email address"
                    name="emailAddress"                     
                    value="<%= incident.emailAddress %>"
                    required 
                    >
                    </input>
                </div>
               
                <div class="form-group">
                    <label for="phoneN">Phone Number</label>
                    <input type="text" class="form-control"
                    id="phoneN"
                    placeholder="Enter phone number"
                    name="phoneNumber"                     
                    value="<%= incident.phoneNumber %>"
                    required
                    >
                    </input>
                </div>
                  
                <% if (incident.incidentStatus == "New" || incident.incidentStatus == "Active" || incident.incidentStatus == "Archived") { %>
                    <div class="form-group">
                        <label for="priorityT">Status</label>
                        <select class="form-select" aria-label="Status" name="incidentStatus">
                            <% if (incident.incidentStatus == "New") { %>
                                    <option value="New" selected>New</option>
                                <% } else { %>
                                    <option value="New">New</option>
                                <% } %>
                                <% if (incident.incidentStatus == "Active") { %>
                                    <option value="Active" selected>Active</option>
                                <% } else { %>
                                    <option value="Active">Active</option>
                                <% } %>
                                <% if (incident.incidentStatus == "Archived") { %>
                                    <option value="Archived" selected>Archive</option>
                                <% } else { %>
                                    <option value="Archived">Archive</option>
                                <% } %>
                        </select>
                    </div>
                <% } %>    
                <% if (incident.incidentStatus == "Archived") { %>
                    </fieldset>
                <% } %>
            
                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-outline-primary" type="submit"><i class="fas fa-edit"></i> Submit</button>
                    <a href="/incident-list" class="btn btn-outline-dark"><i class="fas fa-undo"></i> Cancel</a>
                </div>
            
            </form>

        </div>
      </div>
    </div>



    <!--SECOND DIV BOX -->
    <div class="col">
      <div class="card text-center">
        <div class="card-body">
            <h5 class="card-title">Incident Details</h5>

            <div class="form-group">
                <label for="phoneN">Date Opened (DD-MM-YYYY)</label>
                <input type="text" class="form-control"
                id="incidentDate"
                name="incidentDate"                     
                value="<%=incident.recordNumber.substring(0,2)%>-<%=incident.recordNumber.substring(2,4)%>-<%=incident.recordNumber.substring(4,8)%>"
                disabled>
                </input>
            </div>
            <br>
            <div class="form-floating">Narrative
                <label for="floatingTextarea"></label>
                <textarea class="form-control" style="resize: none;height: 316px" id="narrativeBox"disabled>
                    <%=incident.incidentNarrative%>
            </textarea>
            <br>
   
            <div class="form-floating">Add Comments to Narrative
                <label for="floatingTextarea"></label>
                <input type="text" id="commentBox" class="form-control" style="height: 30px"
                >
                <input type="hidden" id="narrativeSave" name="incidentNarrative" value="<%=incident.incidentNarrative%>">
            </form>
            <br>
            <button class="btn btn-outline-primary" onclick="populateNarrative()">Save Comment</button>
        </div>
       
       
        </div>
      </div>
    </div>
   
  </div>
</div>

<!-- SCRIPT TO FORMAT COMMENT AND SUBMIT TO NARRITIVE BOX-->
<script>
    function populateNarrative(){
var date = new Date();
var day = String(date.getDate()).padStart(2, '0');
var mon = String(date.getMonth() + 1).padStart(2, '0'); 
var year = date.getFullYear();
date = mon + '/' + day + '/' + year;
var comment = document.getElementById("commentBox").value;
var narrative = document.getElementById("narrativeBox").value;
var output = narrative + "\n" + date + ": " + comment;
document.getElementById("narrativeBox").value = output;
document.getElementById("narrativeSave").value = output;
document.getElementById("commentBox").value = "";
//Can we updated incident.incidentNarritive in here? so it saves without having to press the submit button?
}
</script>